<?xml version="1.0" ?>
<project basedir="." default="prepare-dev">
  <property name="applyMerges" value="false" />
  <property name="static" value="false" />
  <property name="downloads" value="imports/downloads/" />
  <property name="dllPrefix" value="Svn-" />
  <property name="intl" value="none" />
  <property name="svnBuildName" value="SlikSvn" />
  <property name="enableIpv6" value="true" />
  <property name="svnStatic" value="true" />
  
  <property name="wc" value="dev" overwrite="false" />
  <property name="branch" value="" overwrite="false" />
  
  <include buildfile="imports/Default.build" />

  <target name="prepare-dev" depends="svn-prepare,build-bdb,build-zlib,build-openssl,build-serf,prepare-neon">
	<if test="${not directory::exists(wc)}">
		<Svn>
			<arg line="co http://svn.collab.net/repos/svn/trunk ${wc}" if="${branch == ''}" />
			<arg line="co http://svn.collab.net/repos/svn/branches/${branch} ${wc}" if="${branch != ''}" />
		</Svn>
	</if>
	<Svn>
		<arg line="up ${wc}" />
	</Svn>
	<uptodate property="regenerate.done">
		<sourcefiles>
			<include name="${wc}/build/win32/build.conf" />
			<include name="${wc}/build/win32/**/*.py" />
			<include name="${wc}/build/win32/**/*.ezt" />
		</sourcefiles>
		<targetfiles basedir="${wc}/build/">
			<!-- Include 1 project as literal to generate on nothing found -->
			<include name="win32/vcnet-vcproj/svn_vcnet.vcproj" />
			<include name="win32/**.vcproj" />			
		</targetfiles>
	</uptodate>
	<if test="${regenerate.done}">
		<property name="pythonAvailable" value="0" />
		<property name="impBase" value="../build/win32" />
		<exec program="cmd.exe" workingdir="${wc}" verbose="true">
        <arg line="/c gen-make.py" if="${pythonAvailable != '0'}" />
        <arg line="/c python.exe gen-make.py" if="${pythonAvailable == '0'}" />
        <arg line="-t vcproj" />
        <arg line="--vsnet-version=2005" if="${VSversion=='2005'}"/>
        <arg line="--vsnet-version=2008" if="${VSversion=='2008'}"/>
        <arg value="--release" />
        <arg value="--with-httpd=../../httpd" if="${(buildHttpd == 'true') and (platform == 'win32')}" />
        <arg value="--with-apr=${impBase}/lib" />
        <arg value="--with-apr-util=${impBase}/lib" />
        <arg value="--with-berkeley-db=${impBase}/lib" />
        <arg value="--with-openssl=${impBase}/openssl-${opensslVersion}" />
        <arg value="--with-zlib=${impBase}/lib/zlib" />
        <arg value="--with-neon=${impBase}/neon" />
        <arg value="--with-serf=${impBase}/serf" />
        <arg value="--with-sasl=${impBase}/lib" />
        <arg value="--enable-nls" if="${intl != 'none'}"/>
        <arg value="--disable-shared" if="${(static=='true') or (svnStatic=='true')}"/>
      </exec>
    </if>
    <echo message="@echo off" file="${wc}/build/${platform}/build_zlib.bat" />
  
  </target>
</project>